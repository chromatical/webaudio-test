{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 6c8f45e14f267dad617b","webpack:///./src/DecibelMeter.js","webpack:///./src/DecibelAnalyser.js","webpack:///./src/PubSub.js","webpack:///./src/index.js","webpack:///./src/registry.js","webpack:///./src/uuid.js"],"names":["DecibelMeter","id","listening","events","_connection","eventName","callback","on","off","dispatch","connection","dBAnalyser","start","stop","identifier","connectTo","then","meter","listen","source","MediaDeviceInfo","Promise","reject","TypeError","resolve","constraints","audio","mandatory","sourceId","deviceId","navigator","mediaDevices","getUserMedia","previous","oldSource","oldStream","stream","trackToDiscard","getAudioTracks","find","track","label","removeTrack","streamSource","disconnect","context","createMediaStreamSource","connect","analyser","AudioContext","createAnalyser","smoothingTimeConstant","lastSample","Uint8Array","addEventListener","running","sources","length","ReferenceError","stopListening","forEach","t","setTimeout","enumerateDevices","devices","filter","device","kind","Error","DecibelAnalyser","_running","getByteFrequencyData","value","percent","dB","minDecibels","maxDecibels","requestAnimationFrame","update","PubSub","eventIndex","index","push","splice","includes","indexOf","params","apply","default","registry","register","getById","__decibelMeters","uuid","d","performance","now","replace","c","r","Math","random","floor","toString"],"mappings":"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","file":"decibel-meter.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"DecibelMeter\"] = factory();\n\telse\n\t\troot[\"DecibelMeter\"] = factory();\n})(this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 3);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 6c8f45e14f267dad617b","import uuid from 'uuid'\r\nimport PubSub from 'PubSub'\r\nimport DecibelAnalyser from 'DecibelAnalyser'\r\nimport { registry, register, getById } from 'registry'\r\n\r\nexport default class DecibelMeter {\r\n\r\n\tconstructor(id = uuid()) {\r\n\t\tthis.id = id\r\n\t\tthis.listening = false\r\n\t\tthis.events = new PubSub(this)\r\n\r\n\t\tthis._connection = null\r\n\r\n\t\tregister(this)\r\n\t}\r\n\r\n\tget source() {\r\n\t\treturn this._connection && this._connection.source ? this._connection.source : null\r\n\t}\r\n\r\n\tget connection() {\r\n\t\treturn this._connection\r\n\t}\r\n\r\n\tget sources() {\r\n\t\tif (navigator.mediaDevices && navigator.mediaDevices.enumerateDevices)\r\n\t\t\treturn navigator.mediaDevices.enumerateDevices().then(devices => devices.filter(device => device.kind === 'audioinput'))\r\n\t\telse\r\n\t\t\treturn Promise.reject(new Error('MediaDevices.enumerateDevices() is not supported'))\r\n\t}\r\n\r\n\tget connected() {\r\n\t\treturn this._connection !== null\r\n\t}\r\n\r\n\ton(eventName, callback) {\r\n\t\tthis.events.on(eventName, callback)\r\n\t\treturn callback\r\n\t}\r\n\r\n\toff(eventName = null, callback = null) {\r\n\t\tthis.events.off(eventName, callback)\r\n\t\treturn callback\r\n\t}\r\n\r\n\tlisten() {\r\n\t\tif (!this.listening) {\r\n\r\n\t\t\tthis.listening = true\r\n\t\t\tthis.events.dispatch('change', this.listening)\r\n\r\n\t\t\tif (this.connection)\r\n\t\t\t\tthis.connection.dBAnalyser.start()\r\n\t\t}\r\n\r\n\t\treturn this\r\n\t}\r\n\r\n\tstopListening() {\r\n\t\tif (this.listening) {\r\n\r\n\t\t\tif (this.connection)\r\n\t\t\t\tthis.connection.dBAnalyser.stop()\r\n\r\n\t\t\tthis.listening = false\r\n\t\t\tthis.events.dispatch('change', this.listening)\r\n\t\t}\r\n\r\n\t\treturn this\r\n\t}\r\n\r\n\tlistenTo(identifier, callback) {\r\n\t\treturn this.connectTo(identifier).then(meter => {\r\n\r\n\t\t\tthis.events.on('sample', callback)\r\n\t\t\tmeter.listen()\r\n\r\n\t\t\treturn this\r\n\t\t})\r\n\t}\r\n\r\n\tconnect(source) {\r\n\t\tif (!(source instanceof MediaDeviceInfo))\r\n\t\t\treturn Promise.reject(new TypeError('DecibelMeter: Expected first parameter to be of type MediaDeviceInfo'))\r\n\t\telse {\r\n\r\n\t\t\t// connection exists, and already connection to requested source\r\n\r\n\t\t\tif (this._connection && this._connection.source === source)\r\n\t\t\t\treturn Promise.resolve(this)\r\n\r\n\t\t\t// audio source constraints\r\n\r\n\t\t\tconst constraints = {\r\n\t\t\t\taudio: {\r\n\t\t\t\t\tmandatory: {\r\n\t\t\t\t\t\tsourceId: source.deviceId // force specific selected device\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// connect\r\n\r\n\t\t\treturn navigator.mediaDevices.getUserMedia(constraints).then(stream => {\r\n\r\n\t\t\t\tlet previous = null, connection\r\n\r\n\t\t\t\t// already have a connection?\r\n\r\n\t\t\t\tif (this._connection) {\r\n\r\n\t\t\t\t\t// note previous source\r\n\r\n\t\t\t\t\tprevious = this._connection.source\r\n\r\n\t\t\t\t\t// we already have a connection, but to a different source\r\n\r\n\t\t\t\t\tconst oldSource = this._connection.source\r\n\t\t\t\t\tconst oldStream = this._connection.stream\r\n\r\n\t\t\t\t\t// disconnect track for old source, if connected to stream\r\n\r\n\t\t\t\t\tconst trackToDiscard = oldStream.getAudioTracks().find(track => track.label === oldSource.label)\r\n\r\n\t\t\t\t\tif (trackToDiscard) {\r\n\t\t\t\t\t\ttrackToDiscard.stop()\r\n\t\t\t\t\t\toldStream.removeTrack(trackToDiscard)\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// stop analyzing dB\r\n\r\n\t\t\t\t\tthis._connection.dBAnalyser.stop()\r\n\r\n\t\t\t\t\t// disconnect stream source\r\n\r\n\t\t\t\t\tthis._connection.streamSource.disconnect()\r\n\r\n\t\t\t\t\t// discard old stream\r\n\r\n\t\t\t\t\tdelete this._connection.stream\r\n\t\t\t\t\tdelete this._connection.streamSource\r\n\r\n\t\t\t\t\t// set new properties\r\n\r\n\t\t\t\t\tconnection = this._connection\r\n\r\n\t\t\t\t\tconnection.source = source\r\n\t\t\t\t\tconnection.stream = stream\r\n\t\t\t\t\tconnection.streamSource = connection.context.createMediaStreamSource(stream)\r\n\t\t\t\t\tconnection.streamSource.connect(connection.analyser)\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\t// first time connecting\r\n\r\n\t\t\t\t\tconnection = { stream, source, context: new AudioContext }\r\n\r\n\t\t\t\t\tconnection.analyser = connection.context.createAnalyser()\r\n\t\t\t\t\tconnection.analyser.smoothingTimeConstant = .5\r\n\t\t\t\t\tconnection.lastSample = new Uint8Array(1)\r\n\t\t\t\t\tconnection.streamSource = connection.context.createMediaStreamSource(stream)\r\n\t\t\t\t\tconnection.streamSource.connect(connection.analyser)\r\n\t\t\t\t\tconnection.dBAnalyser = new DecibelAnalyser(this)\r\n\r\n\t\t\t\t\tconnection.context.addEventListener('ended', () => {\r\n\t\t\t\t\t\tthis.events.dispatch('disconnect')\r\n\t\t\t\t\t})\r\n\r\n\t\t\t\t\tthis._connection = connection\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.events.dispatch('connect', source, previous)\r\n\r\n\t\t\t\t// listening may have started prior to connecting, or source changed\r\n\r\n\t\t\t\tif (this.listening && !connection.dBAnalyser.running)\r\n\t\t\t\t\tconnection.dBAnalyser.start()\r\n\r\n\t\t\t\treturn this // finally, resolve with DecibelMeter itself\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\tconnectTo(identifier) {\r\n\t\treturn this.sources.then(sources => {\r\n\t\t\tif (sources.length === 0)\r\n\t\t\t\tthrow new ReferenceError('DecibelMeter: No audioinput sources available')\r\n\r\n\t\t\tif (typeof identifier === 'number')\r\n\t\t\t\treturn sources[identifier] ? this.connect(sources[identifier]) : Promise.reject(new ReferenceError(`DecibelMeter: Source not found INDEX ${identifier}`))\r\n\r\n\t\t\tif (typeof identifier === 'string') {\r\n\t\t\t\tconst source = sources.find(source => source.deviceId === identifier)\r\n\r\n\t\t\t\treturn source ? this.connect(source) : Promise.reject(new ReferenceError(`DecibelMeter: Source not found DEVICEID ${identifier}`))\r\n\t\t\t}\r\n\r\n\t\t\treturn Promise.reject(new TypeError('DecibelMeter: Invalid source identifier'))\r\n\t\t})\r\n\t}\r\n\r\n\tdisconnect() {\r\n\t\tthis.stopListening()\r\n\r\n\t\tif (this.connection) {\r\n\t\t\tthis.connection.dBAnalyser.stop()\r\n\t\t\tthis.connection.streamSource.disconnect()\r\n\t\t\tthis.connection.stream.getAudioTracks().forEach(t => t.stop())\r\n\t\t}\r\n\r\n\t\treturn new Promise(resolve => {\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tdelete this._connection.stream\r\n\t\t\t\tdelete this._connection.streamSource\r\n\r\n\t\t\t\tthis._connection = null\r\n\r\n\t\t\t\tthis.events.dispatch('disconnect')\r\n\r\n\t\t\t\tresolve(this)\r\n\t\t\t}, 100)\r\n\t\t})\r\n\t}\r\n\r\n\tstatic getMeterById(id) {\r\n\t\treturn getById(id)\r\n\t}\r\n\r\n\tstatic get meters() {\r\n\t\treturn registry()\r\n\t}\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/DecibelMeter.js","export default class DecibelAnalyser {\r\n\r\n\tget running() {\r\n\t\treturn this._running\r\n\t}\r\n\r\n\tconstructor(meter) {\r\n\t\tthis.meter = meter\r\n\t\tthis._running = false\r\n\t}\r\n\r\n\tupdate() {\r\n\t\tlet { analyser, lastSample } = this.meter.connection\r\n\r\n\t\tanalyser.getByteFrequencyData(lastSample)\r\n\r\n\t\t//console.log('audio sample', lastSample)\r\n\r\n\t\tlet value = lastSample[0]\r\n\t\tlet percent = value / 255\r\n\t\tlet dB = analyser.minDecibels + ((analyser.maxDecibels - analyser.minDecibels) * percent)\r\n\r\n\t\tthis.meter.events.dispatch('sample', dB, value, percent, analyser.minDecibels, analyser.maxDecibels)\r\n\r\n\t\tif (this._running)\r\n\t\t\trequestAnimationFrame(() => this.update())\r\n\t}\r\n\r\n\tstart() {\r\n\t\tthis._running = true\r\n\t\tthis.update()\r\n\t}\r\n\r\n\tstop() {\r\n\t\tthis._running = false\r\n\t}\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/DecibelAnalyser.js","export default class PubSub {\r\n\r\n\tconstructor(context) {\r\n\t\tthis.context = context\r\n\t\tthis.eventIndex = {}\r\n\t}\r\n\r\n\tindex(eventName) {\r\n\t\treturn this.eventIndex[eventName] ? this.eventIndex[eventName] : this.eventIndex[eventName] = []\r\n\t}\r\n\r\n\ton(eventName, callback) {\r\n\t\tthis.index(eventName).push(callback)\r\n\t}\r\n\r\n\toff(eventName = null, callback = null) {\r\n\r\n\t\t// remove all callbacks\r\n\r\n\t\tif (eventName === null)\r\n\t\t\treturn this.eventIndex = {}\r\n\r\n\t\tconst index = this.index(eventName)\r\n\r\n\t\t// remove all callbacks for eventName\r\n\r\n\t\tif (callback === null)\r\n\t\t\treturn index.splice(0)\r\n\r\n\t\t// remove specific callback for eventName\r\n\r\n\t\tif (index.includes(callback))\r\n\t\t\tindex.splice(index.indexOf(callback), 1)\r\n\t}\r\n\r\n\tdispatch(eventName, ...params) {\r\n\t\tthis.index(eventName).forEach(callback => callback.apply(this.context, params))\r\n\t}\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/PubSub.js","export { default } from 'DecibelMeter'\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","\r\nexport function registry() {\r\n\tif (typeof navigator.__decibelMeters === 'undefined')\r\n\t\tnavigator.__decibelMeters = {}\r\n\treturn navigator.__decibelMeters\r\n}\r\n\r\nexport function register(meter) {\r\n\treturn registry()[meter.id] = meter\r\n}\r\n\r\nexport function getById(id) {\r\n\treturn registry()[id] || null\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/registry.js","export default function uuid() {\r\n  let d = performance.now();\r\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\r\n    let r = (d + Math.random() * 16) % 16 | 0\r\n    d = Math.floor(d/16);\r\n    return (c=='x' ? r : (r&0x3|0x8)).toString(16);\r\n  })\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/uuid.js"],"sourceRoot":""}